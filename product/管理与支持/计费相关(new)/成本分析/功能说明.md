>!成本分析目前正在灰度体验中，如需体验，可以联系您的客户经理。

成本分析支持消耗概览和消耗汇总，相比消耗明细1.0能提供更详细的消耗信息，主要更新内容如下：
- 支持全产品。
- 支持预付费包年包月和后付费按量计费。
- 支持按照代金券、赠送金和现金三个类型汇总。
- 针对退款、升降配等特殊场景，设计分摊算法。




## 成本分析说明
- 成本分析主要用于客户对每月资源消耗的成本进行分析，由于涉及费用的分摊，不可用于对账及付款。
- 成本分析的功能基于消耗明细数据，提供基于资源 ID、服务类型、项目、地域等各种数据汇总及展示分析。



## 金额分摊规则
对用户购买和消耗数据进行分摊计算，用户消费对应消耗明细金额为正，退还对应消耗明细金额为负。购买或者消耗使用的代金券、赠送金和现金分别记录消耗，按类型做区分。具体分摊规则如下：


#### 后付费按量计费
- “消耗月份”记录为用量实际发生月份。
- 购买的消耗金额，不进行分摊。

#### 预付费一次性购买
- “消耗月份”记录为购买月份，“开始时间”和“结束时间”分别记录为购买当天的00:00:00到23:59:59。
- 购买的消耗金额，不进行分摊。

#### 预付费包年包月新购
- 从新购当天开始分摊，按天产生消耗分摊明细数据，直到资源有效期到期前一天为止。“消耗月份”记录为消耗所在月份，“开始时间”和“结束时间”分别记录为分摊当天的00:00:00到23:59:59。
- 根据订单结束时间和购买的消耗金额，分别计算代金券、赠送金、现金在每天的分摊金额，数据四舍五入保存小数点后两位。如果金额分摊到每天后不足0.01元，则按照每天0.01元从第二天开始分摊，直到购买消耗金额分摊完毕。


#### 预付费包年包月续费
- 从资源续费后新周期第一天开始分摊，按天产生消耗分摊明细数据，直到资源有效期到期前一天为止。“消耗月份”记录为消耗所在月份，“开始时间”和“结束时间”分别记录为分摊当天的00:00:00到23:59:59。
- 根据订单结束时间和购买的消耗金额，分别计算代金券、赠送金、现金在每天的分摊金额，数据四舍五入保存小数点后两位。如果金额分摊到每天后不足0.01元，则按照每天0.01元从第二天开始分摊，直到购买消耗金额分摊完毕。


#### 预付费包年包月升配
- 从资源升配当天开始分摊，按天产生消耗分摊明细数据，直到资源有效期到期前一天为止。“消耗月份”记录为变更当天所在月份，“开始时间”和“结束时间”分别记录为分摊当天的00:00:00到23:59:59。
- 升配前的分摊消耗明细数据不变，根据订单结束时间和购买的消耗金额，分别计算代金券、赠送金、现金在每天的分摊金额，数据四舍五入保存小数点后两位。如果金额分摊到每天后不足0.01元，则按照每天0.01元从第二天开始分摊，直到购买消耗金额分摊完毕。


#### 预付费包年包月降配
- 降配折算时长：延长的时长不做分摊处理。
- 降配退赠送金：
  - 从降配当天起，根据退费金额及资源有效期，按天产生变更分摊费用，直到该资源有效期到期前一天为止。“消耗月份”记录为变更当天所在月份，“开始时间”和“结束时间”分别记录为分摊当天的00:00:00到23:59:59。
  - 降配前的分摊消耗明细数据不变，根据订单结束时间和购买的消耗金额，分别计算代金券、赠送金、现金在每天的分摊金额，数据四舍五入保存小数点后两位。如果金额分摊到每天后不足0.01元，则按照每天0.01从第二天开始分摊，直到购买消耗金额分摊完毕。

#### 预付费包年包月退款
退款前的分摊消耗明细数据不变，退款当天进行退分摊操作，保持 **资源已分摊数据 + 退款当天退分摊数据 = 当月实际消耗数据**，因此退分摊数据可能为负数。
